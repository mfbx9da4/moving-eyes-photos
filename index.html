<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Basics -->
    <meta name="theme-color" content="#ffffff" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="google-site-verification"
      content="vRGNTcXZTAhXYcJLgDPMgGAOuUttLlxPIMdt5rhZfjw"
    />

    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/static/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/static/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/static/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="/static/favicon/site.webmanifest" />

    <!-- SEO / Open Graph -->
    <title>David Alberto Adler</title>
    <meta
      name="Description"
      content="Experienced Full Stack Engineer, Founder and Contractor with a demonstrated history of working with startups and large enterprises. A blend of business and technical skills. Experience in leadership roles. Strongly attuned to business goals and product usability."
    />
    <meta content="David Alberto Adler" property="og:site_name" />
    <meta
      content="Experienced Full Stack Engineer, Founder and Contractor with a demonstrated history of working with startups and large enterprises. A blend of business and technical skills. Experience in leadership roles. Strongly attuned to business goals and product usability."
      property="og:description"
    />
    <meta content="David Alberto Adler" property="og:title" />
    <meta content="profile" property="og:type" />
    <meta
      content="https://davidadler.pages.dev/static/immutable/original/IMG_7983_open_graph.jpeg"
      property="og:image"
    />
    <meta content="David Alberto Adler" property="og:url" />
    <meta property="profile:first_name" content="David" />
    <meta property="profile:last_name" content="Adler" />
    <meta property="profile:gender" content="male" />

    <link
      rel="preload"
      href="/static/immutable/fonts/Virgil.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <style>
      /* Label text color variable */
      :root {
        --label: #333;
        --labelSecondary: rgba(60, 60, 67, 0.6);
        --labelTertiary: rgba(60, 60, 67, 0.3);
        --background: white;
      }

      /* Dark mode */
      @media (prefers-color-scheme: dark) {
        :root {
          --label: white;
          --labelSecondary: rgba(235, 235, 245, 0.6);
          --labelTertiary: rgba(235, 235, 245, 0.3);
          --background: rgb(36, 36, 36);
        }
      }

      @font-face {
        font-family: 'Virgil';
        src: url('/static/immutable/fonts/Virgil.woff2');
        font-display: fallback;
      }
      *,
      *:before,
      *:after {
        box-sizing: border-box;
      }
      * {
        font-family: 'Virgil';
        color: var(--label);
        user-select: none;
      }
      html,
      body {
        background: var(--background);
        margin: 0;
        padding: 0;
      }

      a {
        text-decoration: none;
        padding: 0px 16px 4px 16px;
        margin-bottom: 12px;
      }
      a:hover {
        border-bottom: 1px solid var(--label);
      }

      @media (max-height: 789px) {
        #copyright {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div
      style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100vw;
        /* Apparently solves horizontal scroll issue with scrollbars but not tested https://stackoverflow.com/a/23367686/1376627 */
        max-width: 100%;
        min-height: 80vh;
      "
    >
      <h1 style="text-align: center; font-size: 48px; line-height: 61px">
        David Adler
      </h1>
      <div
        style="
          overflow: hidden;
          position: relative;
          background-color: rgb(242, 235, 240);
          border: solid var(--label);
          border-color: var(--label);
          border-width: 3px 4px 3px 5px;
          border-radius: 95% 4% 92% 5%/4% 95% 6% 95%;
          transform: rotate(2deg);
        "
      >
        <img
          src="/static/immutable/webp/0E9A9000.webp"
          alt="David Adler Face Eyes Follow Mouse"
          id="image"
          width="500"
        />
      </div>

      <!-- Links -->
      <div
        style="
          display: flex;
          margin-top: 20px;
          font-size: 24px;
          width: 100%;
          max-width: 1000px;
          justify-content: space-between;
          padding: 20px;
          flex-wrap: wrap;
          justify-content: center;
        "
      >
        <!-- CV -->
        <a href="/cv.pdf" target="_blank">CV</a>
        <!-- GitHub -->
        <a href="https://github.com/mfbx9da4" target="_blank">GitHub</a>
        <!-- LinkedIn -->
        <a
          href="https://www.linkedin.com/in/david-adler-71056671/"
          target="_blank"
          >LinkedIn</a
        >
        <!-- StackOverflow -->
        <a
          href="https://stackoverflow.com/users/1376627/david-adler"
          target="_blank"
          >StackOverflow</a
        >
        <!-- Twitter -->
        <a href="https://twitter.com/da_adler" target="_blank">Twitter</a>

        <!-- Instagram -->
        <a href="https://www.instagram.com/davidadlerfb/" target="_blank"
          >Instagram</a
        >

        <!-- Hacker News -->
        <a href="https://news.ycombinator.com/user?id=mfbx9da4" target="_blank"
          >Hacker News</a
        >
      </div>
    </div>
    <!-- Positioned in the bottom right hand corner label tertiary -->
    <div
      id="copyright"
      style="
        position: fixed;
        bottom: 0;
        right: 0;
        padding: 10px;
        font-size: 12px;
        color: var(--labelSecondary);
        cursor: pointer;
      "
    ></div>
    <script>
      const copyright = document.getElementById('copyright')
      copyright.innerHTML = 'Â© ' + new Date().getFullYear() + ' David Adler'
      copyright.onclick = () =>
        alert(
          `I only put this here so you have a handy way of knowing the current year is ${new Date().getFullYear()}. You hereby have my permission to come back at any time to check what year it is.`
        )

      const directionVectors = {
        north: { x: 0, y: -1 },
        'north north east': { x: 0.25, y: -0.75 },
        'north east': { x: 0.5, y: -0.5 },
        'north east east': { x: 0.75, y: -0.25 },
        east: { x: 1, y: 0 },
        'south east east': { x: 0.75, y: 0.25 },
        'south east': { x: 0.5, y: 0.5 },
        'south south east': { x: 0.25, y: 0.75 },
        south: { x: 0, y: 1 },
        'south south west': { x: -0.25, y: 0.75 },
        'south west': { x: -0.5, y: 0.5 },
        'south west west': { x: -0.75, y: 0.25 },
        west: { x: -1, y: 0 },
        'north west west': { x: -0.75, y: -0.25 },
        'north west': { x: -0.5, y: -0.5 },
        'north north west': { x: -0.25, y: -0.75 },
      }

      const rawPhotos = [
        {
          url: '/static/immutable/webp/0E9A9000.webp',
          // The direction the photo is pointing
          direction: 'north',
          // The coordinates of the eyes, these are used for aligning the photos so
          // the eyes are in the center of the screen
          leftEye: {
            x: 221.21249999999995,
            y: 248.62499999999994,
          },
          rightEye: {
            x: 306.63749999999993,
            y: 247.34999999999994,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9002.webp',
          direction: 'north east',
          leftEye: {
            x: 223.12499999999994,
            y: 250.53749999999997,
          },
          rightEye: {
            x: 309.18749999999994,
            y: 249.26249999999996,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9003.webp',
          direction: 'north east east',
          leftEye: {
            x: 236.51249999999996,
            y: 251.17499999999995,
          },
          rightEye: {
            x: 323.2125,
            y: 249.89999999999998,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9004.webp',
          direction: 'east',
          leftEye: {
            x: 236.51249999999996,
            y: 257.54999999999995,
          },
          rightEye: {
            x: 323.2125,
            y: 254.99999999999994,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9005.webp',
          direction: 'south east east',
          leftEye: {
            x: 240.97499999999997,
            y: 256.9124999999999,
          },
          rightEye: {
            x: 328.31249999999994,
            y: 254.99999999999994,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9006.webp',
          direction: 'south east',
          leftEye: {
            x: 231.41249999999994,
            y: 256.2749999999999,
          },
          rightEye: {
            x: 320.025,
            y: 250.53749999999997,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9008.webp',
          direction: 'south south east',
          leftEye: {
            x: 233.32499999999996,
            y: 258.825,
          },
          rightEye: {
            x: 320.66249999999997,
            y: 256.2749999999999,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9009.webp',
          direction: 'south',
          leftEye: {
            x: 235.87499999999997,
            y: 255.63749999999993,
          },
          rightEye: {
            x: 328.31249999999994,
            y: 252.44999999999996,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9012.webp',
          direction: 'south south west',
          leftEye: {
            x: 211.64999999999998,
            y: 260.09999999999997,
          },
          rightEye: {
            x: 302.81249999999994,
            y: 257.54999999999995,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9013.webp',
          direction: 'south west',
          leftEye: {
            x: 214.19999999999996,
            y: 256.2749999999999,
          },
          rightEye: {
            x: 306.63749999999993,
            y: 254.99999999999994,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9015.webp',
          direction: 'south west west',
          leftEye: {
            x: 208.46249999999998,
            y: 251.17499999999995,
          },
          rightEye: {
            x: 303.44999999999993,
            y: 249.89999999999998,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9017.webp',
          direction: 'west',
          leftEye: {
            x: 201.44999999999996,
            y: 252.44999999999996,
          },
          rightEye: {
            x: 291.3375,
            y: 248.62499999999994,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9020.webp',
          direction: 'north west',
          leftEye: {
            x: 197.62499999999994,
            y: 254.99999999999994,
          },
          rightEye: {
            x: 290.06249999999994,
            y: 249.26249999999996,
          },
        },
        {
          url: '/static/immutable/webp/0E9A9019.webp',
          direction: 'north north west',
          leftEye: {
            x: 207.82499999999993,
            y: 246.07499999999996,
          },
          rightEye: {
            x: 302.17499999999995,
            y: 240.33749999999995,
          },
        },
      ]

      const hoveredPhoto = {
        url: './static/immutable/webp/0E9A8952_hovered.webp',
        direction: 'north',
        leftEye: {
          x: 207.825,
          y: 249.89999999999998,
        },
        rightEye: {
          x: 297.7125,
          y: 246.075,
        },
      }
      const clickedPhoto = {
        url: './static/immutable/webp/0E9A8956_clicked.webp',
        direction: 'north east',
        leftEye: {
          x: 203.36249999999998,
          y: 260.09999999999997,
        },
        rightEye: {
          x: 297.7125,
          y: 260.73749999999995,
        },
      }

      // Each photo points in a direction convert these human readable directions into vectors
      const photosWithVectors = rawPhotos.map((photo) => {
        const vector = directionVectors[photo.direction]
        if (!vector) {
          throw new Error(`Unknown direction ${photo.direction}`)
        }
        return { ...photo, vector }
      })

      // Convert each direction vector into two vectors indicating the section
      // of the screen it captures flush against it's neighbouring photos
      const photos = photosWithVectors.map((photo, index) => {
        // Indexes wrap around
        const antiClockwise =
          photosWithVectors[
            (index - 1 + photosWithVectors.length) % photosWithVectors.length
          ]
        const clockwise =
          photosWithVectors[(index + 1) % photosWithVectors.length]
        if (!antiClockwise || !clockwise) {
          throw new Error(`Missing neighbour for photo ${photo.url}`)
        }
        let midpointAnticlockwise = {
          x: (photo.vector.x + antiClockwise.vector.x) / 2,
          y: (photo.vector.y + antiClockwise.vector.y) / 2,
        }
        // If this midpoint is infact clockwise of the photo, we need to flip it
        if (
          photo.vector.x * antiClockwise.vector.y -
            photo.vector.y * antiClockwise.vector.x >
          0
        ) {
          console.log('Flipping anticlockwise')
          midpointAnticlockwise = {
            x: -midpointAnticlockwise.x,
            y: -midpointAnticlockwise.y,
          }
        }
        let midpointClockwise = {
          x: (photo.vector.x + clockwise.vector.x) / 2,
          y: (photo.vector.y + clockwise.vector.y) / 2,
        }
        // If this midpoint is infact anticlockwise of the photo, we need to flip it
        if (
          photo.vector.x * clockwise.vector.y -
            photo.vector.y * clockwise.vector.x <
          0
        ) {
          console.log('Flipping clockwise')
          midpointClockwise = {
            x: -midpointClockwise.x,
            y: -midpointClockwise.y,
          }
        }
        return {
          ...photo,
          section: [midpointAnticlockwise, midpointClockwise],
        }
      })

      const frameWidth = Math.min(460, window.innerWidth - 100)
      const targetWidth = frameWidth + 40
      const frameHeight = frameWidth * 1.2
      const image = document.getElementById('image')
      if (!image) {
        throw new Error('Missing image')
      }
      const frame = image.parentElement
      if (!frame) {
        throw new Error('Missing frame')
      }

      frame.style.width = `${frameWidth}px`
      frame.style.height = `${frameHeight}px`

      // Preload all images after the first one has loaded
      let hasLoadedAllImages = false
      image.onload = () => {
        if (hasLoadedAllImages) return
        hasLoadedAllImages = true
        photos.concat([hoveredPhoto, clickedPhoto]).forEach((photo) => {
          const img = new Image()
          img.src = photo.url
        })
      }
      if (image.complete) {
        image.onload()
      }

      function isInCentralPortionOfFace(x, y) {
        const frameRect = frame.getBoundingClientRect()
        const frameAbsoluteCenter = [
          frameRect.left + frameRect.width / 2,
          frameRect.top + frameRect.height / 2,
        ]
        return (
          x > frameAbsoluteCenter[0] - 60 &&
          x < frameAbsoluteCenter[0] + 60 &&
          y > frameAbsoluteCenter[1] - 60 &&
          y < frameAbsoluteCenter[1] + 60
        )
      }

      let lastTimeEnteredFace = 0

      /** @param {MouseEvent | TouchEvent} e */
      function handleMouseMove(e) {
        // get touch or mouse position
        const x = 'clientX' in e ? e.clientX : e.touches[0].clientX
        const y = 'clientY' in e ? e.clientY : e.touches[0].clientY
        // get window size
        const width = window.innerWidth
        const height = window.innerHeight
        const frameCenter = [frameWidth / 2, frameWidth / 2]

        // Get unit vector from center of screen to mouse
        const vector = {
          // x should be from -1 to 1
          x: (x - width / 2) / (width / 2),
          // y should be from -1 to 1
          y: (y - height / 2) / (height / 2),
        }

        // The vector will be inside one of the sections of the photos, find which one
        let closestPhoto = photos.find((closest, photo) => {
          const [lower, upper] = closest.section
          // https://stackoverflow.com/a/17497339/1376627
          // if (AxB * AxC >= 0 && CxB * CxA >= 0)
          // then B is definitely inside A and C
          const lowerInside = vector.x * lower.y - vector.y * lower.x <= 0
          const upperInside = vector.x * upper.y - vector.y * upper.x >= 0
          return lowerInside && upperInside
        })

        const absoluteCenter = [window.innerWidth / 2, window.innerHeight / 2]

        // If we're in the central portion of the face for more than 200ms then show the hovered photo
        if (isInCentralPortionOfFace(x, y)) {
          if (lastTimeEnteredFace === 0) {
            lastTimeEnteredFace = Date.now()
          } else if (Date.now() - lastTimeEnteredFace > 150) {
            closestPhoto = hoveredPhoto
          }
        } else {
          lastTimeEnteredFace = 0
        }

        if (!closestPhoto) {
          throw new Error('Missing closest photo')
        }

        // set image to closest photo
        image.width = targetWidth
        // This is a hardcoded value all the photos have this width
        const naturalWidth = 510
        // We want to align the center of the eyes to the center of the frame
        const ratio = targetWidth / naturalWidth
        const naturalRightEyeCoords = closestPhoto.rightEye
        const naturalLeftEyeCoords = closestPhoto.leftEye
        const naturalCenter = [
          (naturalRightEyeCoords.x + naturalLeftEyeCoords.x) / 2,
          (naturalRightEyeCoords.y + naturalLeftEyeCoords.y) / 2,
        ]
        // Now that we have the natural center we need to scale it down to the target size
        const scaledCenter = [
          naturalCenter[0] * ratio,
          naturalCenter[1] * ratio,
        ]

        // Now we can work out the offset we need to apply to the image
        const offset = [
          frameCenter[0] - scaledCenter[0],
          frameCenter[1] - scaledCenter[1],
        ]
        image.src = closestPhoto.url
        image.style.transform = `translate(${offset[0]}px, ${offset[1]}px)`
      }

      function handleOnResize() {
        // If the last href and the h1 are all in the viewport then we can block scrolling
        // to make for a better experience on mobile
        const lastHref = document.querySelector('a:last-of-type')
        const h1 = document.querySelector('h1')
        if (!lastHref || !h1) {
          console.warn('Missing last href or h1')
        }
        const lastHrefRect = lastHref.getBoundingClientRect()
        const h1Rect = h1.getBoundingClientRect()
        const lastHrefInViewport =
          lastHrefRect.top >= 0 &&
          lastHrefRect.left >= 0 &&
          lastHrefRect.bottom <= window.innerHeight &&
          lastHrefRect.right <= window.innerWidth
        const h1InViewport =
          h1Rect.top >= 0 &&
          h1Rect.left >= 0 &&
          h1Rect.bottom <= window.innerHeight &&
          h1Rect.right <= window.innerWidth
        if (lastHrefInViewport && h1InViewport) {
          document.body.style.overflow = 'hidden'
        } else {
          document.body.style.overflow = 'auto'
        }
      }

      /** @param {MouseEvent} e */
      function handleClick(e) {
        // If we click and we're in the central portion of the face then show the clicked photo
        const x = e.clientX
        const y = e.clientY
        if (isInCentralPortionOfFace(x, y)) {
          image.src = clickedPhoto.url
        }
      }

      window.addEventListener('click', handleClick)
      window.addEventListener('mousemove', handleMouseMove)
      window.addEventListener('touchstart', handleMouseMove)
      window.addEventListener('touchmove', handleMouseMove)
      window.addEventListener('resize', handleOnResize)

      // Fake a mouse move north of the screen to start
      handleMouseMove({ clientX: window.innerWidth / 2, clientY: 0 })
      // Fake a resize to start
      handleOnResize()
    </script>

    <!-- Cloudflare Web Analytics -->
    <script
      defer
      src="https://static.cloudflareinsights.com/beacon.min.js"
      data-cf-beacon='{"token": "faf9c306bd1c4e6983fe6b90dbdf01b1"}'
    ></script>
    <!-- End Cloudflare Web Analytics -->
  </body>
</html>
